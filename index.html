<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>小球遊戲多球加速版</title>
<style>
body { margin:0; overflow:hidden; background:#222; font-family:Arial,sans-serif; }
#score, #time, #high { position:absolute; color:#fff; font-size:24px; z-index:10; }
#score { top:10px; left:10px; }
#time { top:10px; right:10px; }
#high { top:40px; left:10px; }
canvas { display:block; }
</style>
</head>
<body>
<div id="score">分數: 0</div>
<div id="time">時間: 30</div>
<div id="high">最高分: 0</div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// 玩家球
let player = { x: canvas.width/2, y: canvas.height/2, r:40, flash:0, hue:0 };
let mouse = { x: player.x, y: player.y };
document.addEventListener("mousemove", e=>{ mouse.x=e.clientX; mouse.y=e.clientY; });

// 彩色點漂浮 (多球模式)
let dots = [];
for(let i=0;i<15;i++){ // 多球
  dots.push({ 
    x: Math.random()*canvas.width, 
    y: Math.random()*canvas.height, 
    r:15 + Math.random()*15, 
    color:`hsl(${Math.random()*360},80%,50%)`,
    dx: Math.random()*2-1, 
    dy: Math.random()*2-1
  });
}

// 彩色尾巴
let tails = [];

let score = 0;
let highScore = localStorage.getItem("highScore") || 0;
document.getElementById("high").innerText = "最高分: "+highScore;

let timeLeft = 30;
let gameOver = false;

// 倒數計時
let timer = setInterval(()=>{
  if(gameOver) return;
  timeLeft--;
  document.getElementById("time").innerText = "時間: "+timeLeft;
  if(timeLeft <= 0){
    gameOver = true;
    alert("時間到！本局分數: "+score);
    if(score > highScore){
      highScore = score;
      localStorage.setItem("highScore", highScore);
      document.getElementById("high").innerText = "最高分: "+highScore;
    }
  }
},1000);

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(!gameOver){
    // 加速模式：速度隨距離增加
    let speed = 0.2 + Math.min(1, Math.abs(mouse.x-player.x)/200 + Math.abs(mouse.y-player.y)/200);
    player.x += (mouse.x - player.x)*speed;
    player.y += (mouse.y - player.y)*speed;

    // 彩色尾巴隨球顏色漸變
    tails.push({ x: player.x, y: player.y, r: player.r/2, alpha:1, hue:player.hue });
    player.hue = (player.hue + 2) % 360;
    for(let i=tails.length-1;i>=0;i--){
      let t = tails[i];
      ctx.beginPath();
      ctx.arc(t.x, t.y, t.r,0,Math.PI*2);
      ctx.fillStyle = `hsla(${t.hue},80%,50%,${t.alpha})`;
      ctx.fill();
      t.alpha -= 0.03;
      if(t.alpha <= 0) tails.splice(i,1);
    }

    // 畫彩色點 & 漂浮 & 碰撞
    dots.forEach(d=>{
      d.x += d.dx; d.y += d.dy;
      if(d.x<d.r || d.x>canvas.width-d.r) d.dx*=-1;
      if(d.y<d.r || d.y>canvas.height-d.r) d.dy*=-1;

      ctx.beginPath();
      ctx.arc(d.x,d.y,d.r,0,Math.PI*2);
      ctx.fillStyle = d.color;
      ctx.fill();

      let dx = player.x - d.x;
      let dy = player.y - d.y;
      let dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < player.r + d.r){
        score++;
        document.getElementById("score").innerText = "分數: "+score;
        d.x = Math.random()*canvas.width;
        d.y = Math.random()*canvas.height;
        player.r = 40 + score*0.5;
        player.flash = 5;
      }
    });

    // 畫玩家球
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
    ctx.fillStyle = player.flash>0 ? "#ff0" : `hsl(${player.hue},80%,50%)`;
    ctx.fill();
    if(player.flash>0) player.flash--;
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
